I"á<p>One of the most popular ways to obtain data from SAP system is OData. To set it up, you need at least basic knowledge about ABAP and SAP. There is another way too using mainly Python.</p>

<!--more-->

<p>Here you need to know what is <code class="language-plaintext highlighter-rouge">function module</code>. For this example I‚Äôll make it very simple. Treat it like a simple function with input and output. That‚Äôs it üòâ.</p>

<h3 id="what-we-need">What we need</h3>

<ul>
  <li><a href="https://support.sap.com/en/product/connectors/nwrfcsdk.html">SAP NetWeawer RFC SDK</a></li>
  <li><a href="https://github.com/SAP/PyRFC">PyRFC</a></li>
  <li>Some SAP system ü§∑‚Äç‚ôÄÔ∏è</li>
</ul>

<p>Follow <a href="http://sap.github.io/PyRFC/install.html">this</a> installation steps. I found them very useful. I warn you, it is not easy with Windows üòâ.</p>

<h3 id="sap-client">SAP Client</h3>

<p>First thing is to make connection with system. Remember to check if your IP is authorized to connect with it.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyrfc</span> <span class="kn">import</span> <span class="n">Connection</span>

<span class="n">con</span> <span class="o">=</span> <span class="n">Connection</span><span class="p">(</span>
    <span class="n">user</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s">"user"</span><span class="p">],</span>
    <span class="n">passwd</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s">"password"</span><span class="p">],</span>
    <span class="n">mshost</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s">"mshost"</span><span class="p">],</span>
    <span class="n">msserv</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s">"msserv"</span><span class="p">],</span>
    <span class="n">sysid</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s">"sysid"</span><span class="p">],</span>
    <span class="n">group</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s">"group"</span><span class="p">],</span>
    <span class="n">saprouter</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s">"saprouter"</span><span class="p">],</span>
    <span class="n">client</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s">"client"</span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div></div>

<p>I like to pass all configuration as a dictionary and keep it in env variables or another file.</p>

<h3 id="get-data">GET DATA</h3>

<p>The whole idea is to trigger the FM (function module) as I mention. In SAP standard lib there is FM called <code class="language-plaintext highlighter-rouge">RFC_READ_TABLE</code>. We can use it to make a select statement to database.</p>

<p>Use method <code class="language-plaintext highlighter-rouge">call</code> of <code class="language-plaintext highlighter-rouge">Connection</code> object. The first parameter is the FM name. In this case it is <code class="language-plaintext highlighter-rouge">RFC_READ_TABLE</code>. Next parameters are the same as in interface in FM. You can check it in <code class="language-plaintext highlighter-rouge">se37</code> T-code in SAP.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">response</span> <span class="o">=</span> <span class="n">con</span><span class="p">.</span><span class="n">call</span><span class="p">(</span>
    <span class="n">fm_name</span><span class="p">,</span>
    <span class="n">QUERY_TABLE</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span>
    <span class="n">DELIMITER</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span>
    <span class="n">FIELDS</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
    <span class="n">OPTIONS</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
    <span class="n">ROWCOUNT</span><span class="o">=</span><span class="n">rowcount</span><span class="p">,</span>
    <span class="n">ROWSKIPS</span><span class="o">=</span><span class="n">rowskips</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Display the obtained data and play with string splitting a bit üòÖ.</p>

<p>Nice to remember:</p>

<ul>
  <li>All rows from table are single strings. Use delimiter that fits in your code and split them</li>
  <li>To know the exact type of fields you can use FM <code class="language-plaintext highlighter-rouge">DDIF_FIELDINFO_GET</code></li>
  <li><code class="language-plaintext highlighter-rouge">RFC_READ_TABLE</code> has a problem with wide tables. Using <code class="language-plaintext highlighter-rouge">DDIF_FIELDINFO_GET</code>, you can check how many fields such table has, which are the keys and download them in chunks.</li>
  <li>It always good idea to limit fields in select statement. Not only in <code class="language-plaintext highlighter-rouge">RFC_READ_TABLE</code>. Use parameter FIELDS to pass a list with fields names which you want to obtain.</li>
</ul>

<p>You can use PyRFC to trigger your custom FM too. For example, you can make some python script which will invoke some workflows in SAP etc.</p>

<p>Do you use PyRFC? If you know more good practices in calling FM from Python, write them down in a comment üòâ</p>
:ET